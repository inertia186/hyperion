var account_name = '<%= @account_name %>';
var login_fields = $('input');

login_fields.prop('readonly', true);

hive_keychain.requestSignBuffer(account_name, '<%= @random_oneliner %>', 'Posting', function (response) {
  success_alert = $('#success-alert');
  error_alert = $('#error-alert');
  
  if (response.success) {
    error_alert.text('');
    error_alert.hide();
    
    success_alert.html('<div class="d-flex align-items-center"><strong>Logging in as ' + response.data.username + '</strong><div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>');
    success_alert.show();
    
    authorized_session_path = '<%= authorized_session_path(@account_name) %>';
    window.location.assign(authorized_session_path + '?public_key=' + response.publicKey + '&result=' + response.result);
  } else {
    success_alert.text('');
    success_alert.hide();
    error_alert.text(response.message);
    error_alert.show();
    login_fields.prop('readonly', false);
  }
});
